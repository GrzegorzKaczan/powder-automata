<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8"/>
  
 </head>
 <body>
    
    <canvas id="canvas" width="520" height="520" style="background: black;"></canvas>
    <div>
        </br>
        <b>cellular automata</b> </br>(simulating 250k grains at once)
        </br>
        </br>
        <p>mouse left click for sand</p>
        <p>mouse right click for water</p>
        <p>mouse middle click for fire (on sand)</p>
    </div>
    <script src="definitions.js"></script>
    <script src="init.js"></script>
    <script src="mouse.js"></script>
    <script src="stages/resetState.js"></script>
    <script src="stages/physics.js"></script>
    <script src="stages/draw.js"></script>
    <script type="application/javascript">

        arr[80][100][1] = Types.SAND;
        arr[100][100][1] = Types.SAND;
        arr[80][120][1] = Types.SAND;
        arr[80][140][1] = Types.SAND;
        arr[80][160][1] = Types.SAND;
        arr[80][160][1] = Types.SAND;
        arr[100][160][1] = Types.SAND;

        arr[170][100][1] = Types.SAND;
        arr[170][120][1] = Types.SAND;
        arr[170][140][1] = Types.SAND;
        arr[170][160][1] = Types.SAND;
        arr[190][160][1] = Types.SAND;
        arr[210][160][1] = Types.SAND;

        arr[260][100][1] = Types.SAND;
        arr[260][120][1] = Types.SAND;
        arr[260][140][1] = Types.SAND;
        arr[260][160][1] = Types.SAND;

        arr[310][100][1] = Types.SAND;
        arr[330][100][1] = Types.SAND;
        arr[310][120][1] = Types.SAND;
        arr[310][140][1] = Types.SAND;
        arr[310][160][1] = Types.SAND;
        arr[310][160][1] = Types.SAND;
        arr[330][160][1] = Types.SAND;

        arr[380][100][1] = Types.SAND;
        arr[380][120][1] = Types.SAND;
        arr[380][140][1] = Types.SAND;
        arr[380][160][1] = Types.SAND;
        arr[410][160][1] = Types.SAND;
        arr[390][140][1] = Types.SAND;
        arr[410][100][1] = Types.SAND;
        arr[390][120][1] = Types.SAND;
        
        for (let i = 3; i < size - 3; i++) {
            for (let j = 3; j < size - 3; j++) {
                if (arr[i][j][1] === Types.SAND) {
                    arr[i-1][j-1][1] = Types.SAND;
                    arr[i-1][j][1] = Types.SAND;
                    arr[i][j - 1][1] = Types.SAND;
                }
            }   
        }
        

        function update() {
            resetState();
            physics();
        }

        function repaint() {
            draw();
        }

        // physics loop
        setTimeout(function() {
            setInterval(update, 1)
        }, 1000);

        // paint loop
        setInterval(repaint, 1);

    </script>
 </body>
</html>